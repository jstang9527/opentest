package conf

import (
	"time"

	"github.com/jstang9527/opentest/ops"

	"gopkg.in/ini.v1"
)

// AppCfg 应用程序
type AppCfg struct {
	QemuCfg  `ini:"qemu"`
	MysqlCfg `ini:"mysql"`
}

// QemuCfg 客户端
type QemuCfg struct {
	Network string        `ini:"network"`
	Address string        `ini:"address"`
	TimeOut time.Duration `ini:"timeout"`
}

// MysqlCfg 客户端
type MysqlCfg struct {
	UserName string `ini:"username"`
	Password string `ini:"password"`
	Address  string `ini:"address"`
}

// Cfg ...

// Init 加载配置文件信息
func Init(cfg *AppCfg) (err error) {
	if err = ini.MapTo(cfg, "./conf/conf.ini"); err != nil {
		ops.Console("load ini failed, err: %v", err)
		return
	}
	ops.Console("load ini success, now check these value.")
	ops.Console("Qemu network:%v, address:%v, timeout:%v", cfg.QemuCfg.Network, cfg.QemuCfg.Address, cfg.QemuCfg.TimeOut)
	ops.Console("Mysql user:%v, passwd:%v, address:%v", cfg.MysqlCfg.UserName, cfg.MysqlCfg.Password, cfg.MysqlCfg.Address)
	return
}
