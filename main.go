package main

import (
	"net"

	"github.com/jstang9527/opentest/conf"
	"github.com/jstang9527/opentest/expect"
	"github.com/jstang9527/opentest/ops"
)

var cfg = new(conf.AppCfg)
var domainName = "node"
var qemuConn net.Conn

func main() {
	//-------------------------------------------------0.加载配置文件--------------------------------------------------------
	if err := conf.Init(cfg); err != nil {
		ops.Console("laod ini conf faile, err: %v", err)
		return
	}

	//------------------------------------------------1.创建QEMU客户端-------------------------------------------------------
	if err := expect.Init(cfg.QemuCfg.Network, cfg.QemuCfg.Address, cfg.QemuCfg.TimeOut); err != nil {
		ops.Console("failed to connect to hypervisor: %v", err)
		return
	}
	//--------------------------------------------------2.虚拟机管理---------------------------------------------------------
	myVM := expect.VM{Domain: "node"}
	if err := myVM.Start(); err != nil {
		ops.Console("failed start vm, err: %v", err)
		return
	}
	// --------------------------------------------------------------------------------------------------------------

}
