package thirdpart

import (
	"fmt"
	"time"

	"github.com/tebeka/selenium"
)

/*	+ 导航栏buttom按钮
		- 弹钮、弹窗必须等待加载 time.Sleep()
   	+ 进入首页
   	+ 进入系统配置页
   	+ 进入蜜罐管理页面
*/

//根据ID进入对应的页面，适用于没有tabbar没有子项的[威胁概览(home)、威胁报告、用户管理]
func (t *TestTask) entryTabbar(id int) (err error) {
	var btn selenium.WebElement
	xpath := fmt.Sprintf(`//*[@id="root"]/div/nav/ul/li[%d]`, id)
	if err = t.laodwait(); err != nil {
		return
	}
	//1.找对应的tabbar按钮
	btn, err = t.Wd.FindElement(selenium.ByXPATH, xpath)
	if err != nil {
		return
	}
	//2.点击tabbar按钮
	btn.Click()
	//3.加载页面
	err = t.laodwait()
	return
}

// 导航栏进入虚拟蜜罐管理页面
func (t *TestTask) entryHoneypotMgr() (err error) {
	var btn selenium.WebElement
	if err = t.entryTabbar(7); err != nil {
		err = fmt.Errorf("failed entry honeypot control page, err: %v", err)
		return
	}

	time.Sleep(time.Second)
	//3.找子项=>虚拟蜜罐管理
	btn, err = t.Wd.FindElement(selenium.ByXPATH, `//*[@id="/manager$Menu"]/li[2]`)
	if err != nil {
		err = fmt.Errorf("honeypot mgr buttom not found in home page, err: %v", err)
		return
	}
	time.Sleep(time.Second)
	//4.点击蜜罐管理buttom
	btn.Click()
	//5.加载页面
	err = t.laodwait()
	return
}
