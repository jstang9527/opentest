package honeypotmanager

import (
	"fmt"
	"time"

	"github.com/jstang9527/opentest/model"
	"github.com/tebeka/selenium"
)

//HoneypotRoute ...
func HoneypotRoute(pid string, wd selenium.WebDriver) {
	//找到buttom
	sysBtn, err := wd.FindElement(selenium.ByXPATH, `//*[@id="root"]/div/nav/ul/li[7]`)
	if err != nil {
		message := fmt.Sprintln("sysconf buttom not found.", err)
		now := time.Now()
		sname := now.Format("20060102150405000")
		saveRecord(pid, name, message, sname, now.Sub(start), priority, model.Error)
		saveScreenshot(wd, sname)
		return
	}
	//点击系统配置
	err = sysBtn.Click()
	if err != nil {
		message = fmt.Sprintln("can't click sysconf buttom.", err)
		now := time.Now()
		sname := now.Format("20060102150405000")
		saveRecord(pid, name, message, sname, now.Sub(start), priority, model.Error)
		saveScreenshot(wd, sname)
		return
	}
	fmt.Println("alreay .")

	//并发执行子项目
	checkImg(pid, wd)
	checkMachine(pid, wd)
}
