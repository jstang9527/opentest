package selenium

import (
	mops "github.com/jstang9527/opentest/ops"

	"github.com/tebeka/selenium"
	"github.com/tebeka/selenium/chrome"
)

const (
	//设置常量 分别设置chromedriver.exe的地址和本地调用端口
	seleniumPath = `/root/chromedriver`
	port         = 9515
)

var (
	chromeCaps = chrome.Capabilities{
		// Prefs: imgCaps,
		Path: "",
		Args: []string{
			"--headless",
			"--start-maximized",
			"--window-size=1920x1080",
			"--no-sandbox",
			"--user-agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36",
			"--disable-gpu",
			"--disable-impl-side-painting",
			"--disable-gpu-sandbox",
			"--disable-accelerated-2d-canvas",
			"--disable-accelerated-jpeg-decoding",
			"--test-type=ui",
			"--ignore-certificate-errors",
		},
	}
	//设置selenium服务的选项,设置为空。根据需要设置。
	ops     = []selenium.ServiceOption{}
	service *selenium.Service
	//设置浏览器兼容性，设置浏览器名称为chrome
	caps = selenium.Capabilities{"browserName": "chrome"}
)

// Init 初始化一个service后台服务
func Init() (err error) {
	//1.开启selenium服务
	service, err = selenium.NewChromeDriverService(seleniumPath, port, ops...)
	if err != nil {
		return
	}
	// defer service.Stop() 不需要关闭
	mops.Console("start the ChromeDriver server success, :%v", port)
	return
}
